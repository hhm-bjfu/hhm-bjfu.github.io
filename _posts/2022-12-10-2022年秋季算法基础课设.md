---
layout:	post
title:	2022年秋季算法基础课设
categories:	[Homework]
---



## 初版代码

```cpp
#include <iostream>
#include <cstdio>
#include <algorithm>
#include <cstring>
#include <stack>
#include <map>

using namespace std;

/* 定义Latex公式对应运算符 */
map<string, string> operatorMp;


string Latex_to_list(string str) {
    int n = str.size();
    for (int i = 0; i < n; i ++)
        if(str[i] == '\\') {
            int index = i + 1;
            string tmp = "";
            while (str[index] != ' ') { // 意味这Latex字符串中，\times类似操作符一定与其他字符有空格断开，特别注意\left(后面需要是空格
                string s(1, str[index]);
                tmp += s;
                index ++;
            }
//            cout << tmp << "对应字符是：" << operatorMp[tmp] << endl;
            str.replace(i, index - i, operatorMp[tmp]);
            n -= (index - i);
        }

    return str;
}

bool is_Latex(string str) {
    if (str[0] != '$' || str[str.size() - 1] != '$')
        return false;
    return true;
}

bool delim(char c) {return c == ' ';}
bool is_op(char c) {return c == '+' || c == '-' || c == '*' || c == '/';}

int priority(char op) { // 字符op的优先级
    if (op == '+' || op == '-') return 1;
    if (op == '*' || op == '/') return 2;
    return -1;
}

void process(stack<int> &st, char op) {
    int r = st.top();                         // 取出栈顶元素
    st.pop();
    int l = st.top();
    st.pop();
    switch (op) {
        case '+':
            st.push(l + r);
            break;
        case '-':
            st.push(l - r);
            break;
        case '*':
            st.push(l * r);
            break;
        case '/':
            st.push(l / r);
            break;
    }
}

int main() {
    /* 初始化部分 */
    cout << "请输入Latex字符串：";
    string input_str;
    getline(cin, input_str);
    cout << "是否需要进行四则运算：1——需要\t\t0——不需要" << endl;
    int select; cin >> select;

    stack<int> integer1, integer2;
    stack<char> character1, character2;
    vector<string> tree1, tree2; // 接收两个字符串处理完后的序列
    operatorMp.insert(pair{"times", "*"});
    operatorMp.insert(pair{"left(", "("});
    operatorMp.insert(pair{"right)", ")"});


    /* 判断是否为正确Latex表达式 */
    bool flag = is_Latex(input_str);
    if (!flag) {cout << "这不是正确的Latex表达式！\n"; return 0;}

    /* 分成数字字母栈和操作符栈 */
    // 本次只考虑有 ‘=’ 符号的字符串
    int len = input_str.size();
    // 以 ‘=’ 为界，分为两半
    int index = -1; // 记录 ‘=’ 位置
    for (int i = 1; i < len - 1; i ++)
        if (input_str[i] == '=') {
            index = i;
            break;
        }
    string input_str1 = input_str.substr(1, index - 1);
    string input_str2 = input_str.substr(index + 1, len - index - 2);

    /* 从Latex到运算序列 */
    string str1 = Latex_to_list(input_str1);
    string str2 = Latex_to_list(input_str2);

    if (!select) {
        cout << str1 + " = " + str2 << endl;
        return 0;
    }else {
        for (int i = 0; i < input_str1.size(); i ++) {
            if (delim(input_str1[i])) continue; // 空格跳过

            if (input_str1[i] == '(') // 左括号
                character1.push('(');
            else if (input_str1[i] == ')') {// 右括号
                while (character1.top() != '(') {
                    process(integer1, character1.top());
                    character1.pop();
                }
                character1.pop(); // 左括号出栈
            }else if (is_op(input_str1[i])) { // + - × / 运算符
                char cur_op = input_str1[i]; // 当前运算符
                while (!character1.empty() && priority(character1.top()) >= priority(cur_op)) {
                    process(integer1, character1.top());
                    character1.pop();  // 不断输出所有运算优先级大于等于当前运算符的运算符
                }
                character1.push(cur_op);  // 新的运算符入运算符栈
            }else {            // 1. 如果遇到数字，直接输出该数字
                int number = 0;
                while (i < (int)input_str1.size() && isalnum(input_str1[i]))
                    number = number * 10 + input_str1[i++] - '0';
                --i;
                integer1.push(number);
            }
        }

        while (!character1.empty()) {
            process(integer1, character1.top());
            character1.pop();
        }

        cout << integer1.top() << " = ";


        for (int i = 0; i < input_str2.size(); i ++) {
            if (delim(input_str2[i])) continue; // 空格跳过

            if (input_str2[i] == '(') // 左括号
                character2.push('(');
            else if (input_str2[i] == ')') {// 右括号
                while (character2.top() != '(') {
                    process(integer2, character2.top());
                    character2.pop();
                }
                character2.pop(); // 左括号出栈
            }else if (is_op(input_str2[i])) { // + - × / 运算符
                char cur_op = input_str2[i]; // 当前运算符
                while (!character2.empty() && priority(character2.top()) >= priority(cur_op)) {
                    process(integer2, character2.top());
                    character2.pop();  // 不断输出所有运算优先级大于等于当前运算符的运算符
                }
                character2.push(cur_op);  // 新的运算符入运算符栈
            }else {            // 1. 如果遇到数字，直接输出该数字
                int number = 0;
                while (i < (int)input_str2.size() && isalnum(input_str2[i]))
                    number = number * 10 + input_str2[i++] - '0';
                --i;
                integer2.push(number);
            }
        }

        while (!character2.empty()) {
            process(integer2, character2.top());
            character2.pop();
        }

        cout << integer2.top() << endl;
    }


    return 0;
}
```

